class PlainGallery extends EventTarget{static Zoom={MIN_SCALE:2,MAX_SCALE:10,STEP:1.2};static State={OPENING:10,OPENED:11,SLIDING:20,CLOSING:30,CLOSED:31};static Event={OPEN:"open",CHANGE:"change",CLOSE:"close",IMAGE_LOADED:"imageLoaded"};static createElement(t){if(t){if(0===(t=t.replace(/[\t\r\n]/gm,"").trim()).indexOf("<")){const e=document.createElement("template");return e.innerHTML=t,e.content.firstElementChild}return document.createElement(t)}}current=null;dataSource=[];state=PlainGallery.State.CLOSED;isTransitioning=!1;shadeMask=new PlainGallery.ShadeMask(this);toolbar=new PlainGallery.Toolbar(this);viewport={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};constructor(t,e){super(),window.addEventListener("resize",this.#t.bind(this)),window.addEventListener("keyup",this.#e.bind(this));const{el:i}=this.shadeMask;i.addEventListener("pointerup",this.#i.bind(this)),i.addEventListener("pointerdown",this.#n.bind(this)),i.addEventListener("wheel",this.#s.bind(this));let n=-1;for(const i of document.querySelectorAll(t)){const t=[];this.dataSource.push(t),n++;let s=0;for(const a of i.querySelectorAll(e)){const e=a.querySelector("img");e&&(t.push({thumbnail:e}),e.originalUrl=a.getAttribute("href"),e.ordinal=n,e.index=s++,e.addEventListener("click",(t=>{t.preventDefault(),this.#a(t.target)})))}}}#a(t){const{OPENING:e,CLOSED:i}=PlainGallery.State;this.isTransitioning||this.state!==i||(this.state=e,this.current=this.#r(t),this.shadeMask.fadeIn(),this.#l(),this.#o(!0))}#o(t){const{current:e}=this,{rect:i}=e,{width:n,height:s}=this.viewport,a=n/s;e.scale=e.aspectRatio>a?n/i.width:s/i.height,e.initScale=e.scale,e.minScale=e.scale/PlainGallery.Zoom.MIN_SCALE,e.maxScale=e.scale*PlainGallery.Zoom.MAX_SCALE,e.initX=e.transX=n/2-e.centerPoint.x,e.initY=e.transY=s/2-e.centerPoint.y,t?setTimeout(e.transform):e.transform()}#i(t){const{target:e}=t,{current:i,shadeMask:n,toolbar:s}=this,{prevBtn:a,nextBtn:r}=n;i.contains(e)||s.el.contains(e)||(a.contains(e)||r.contains(e)?this.slide(e.closest("svg").direction):this.close())}#s(t){t.preventDefault();const{current:e}=this;!this.isTransitioning&&e.contains(t.target)&&(t.wheelDelta>0?e.scale*=PlainGallery.Zoom.STEP:e.scale/=PlainGallery.Zoom.STEP,e.scale>e.maxScale&&(e.scale=e.maxScale),e.scale<e.minScale&&(e.scale=e.minScale),e.transform(),this.#h())}#n(t){t.preventDefault();const e=this,{current:i}=this;!this.isTransitioning&&i.contains(t.target)&&(i.isMoved=!1,i.startX=t.clientX,i.startY=t.clientY,i.css("transition:none; cursor:grab"),i.onpointermove=function(t){this.isMoved=!0,this.offsetX=t.clientX-this.startX,this.offsetY=t.clientY-this.startY,this.style.cursor="grabbing",this.transform(this.transX+this.offsetX,this.transY+this.offsetY,null)},i.onpointerup=i.onpointerout=function(t){if(this.transX+=this.offsetX??0,this.transY+=this.offsetY??0,this.style.transition="all .3s",this.onpointermove=null,"pointerup"==t.type&&!this.isMoved){const{width:i,height:n}=e.viewport;this.transX=i-this.centerPoint.x-t.clientX,this.transY=n-this.centerPoint.y-t.clientY,this.scale=this.scale<=this.initScale?this.scale*=2:this.initScale,this.transform()}e.#h()})}#t(){if(this.viewport.width=document.documentElement.clientWidth,this.viewport.height=document.documentElement.clientHeight,this.state===PlainGallery.State.CLOSED)return;this.#o();const{current:t}=this,{ordinal:e,index:i}=t;t.rect=this.#c(e,i).getBoundingClientRect()}#e(t){27===t.keyCode&&this.close()}#l(){const{prevBtn:t,nextBtn:e}=this.shadeMask,{ordinal:i,index:n}=this.current,s=this.dataSource[i].length-1;t.style.visibility=0==n?"hidden":"visible",e.style.visibility=n==s?"hidden":"visible"}#h(){const{current:t}=this;t.style.cursor=t.scale<=t.initScale?"zoom-in":"zoom-out";const{rect:e}=t,i=e.width*t.scale,n=e.height*t.scale,s={x1:t.initX,x2:t.initX,y1:t.initY,y2:t.initY};i>this.viewport.width&&(s.x1=i/2-t.centerPoint.x,s.x2=s.x1-(i-this.viewport.width)),n>this.viewport.height&&(s.y1=n/2-t.centerPoint.y,s.y2=s.y1-(n-this.viewport.height));let a=!1;t.transX>s.x1&&(t.transX=s.x1,a=!0),t.transX<s.x2&&(t.transX=s.x2,a=!0),t.transY>s.y1&&(t.transY=s.y1,a=!0),t.transY<s.y2&&(t.transY=s.y2,a=!0),a&&t.transform()}#c(t,e){const i=this.dataSource[t],n=i.length-1;return e<0||e>n?null:i[e].thumbnail}#r(t){const e=PlainGallery.createElement('<div class="plga-preview-zone"></div>'),i=t.getBoundingClientRect(),{ordinal:n,index:s}=t;e.ordinal=n,e.index=s,e.rect=i,e.aspectRatio=i.width/i.height,e.centerPoint={x:i.left+i.width/2,y:i.top+i.height/2},e.css=t=>{let i=e.style.cssText;const n=i.length-1;n>=0&&i.indexOf(";",n)==n&&(i+=";"),e.style.cssText=i+t},e.transform=(t,i,n)=>{e.css(`--transX: ${t??e.transX}px; --transY: ${i??e.transY}px; --scale: ${n??e.scale}`)},e.restore=()=>{const{rect:t}=e;e.css(`left:${t.left}px; top:${t.top}px; width:${t.width}px; height:${t.height}px;`),e.transform(0,0,1)};const a=this.dataSource[n][s];return a.placeholder||(a.placeholder=t.cloneNode(!0),a.placeholder.className="plga-image-placeholder"),!a.original&&t.originalUrl&&(a.original=t.cloneNode(!0),a.original.className="plga-image-placeholder"),e.ontransitionstart=()=>{this.isTransitioning=!0},e.ontransitionend=()=>{this.isTransitioning=!1;const{State:i,Event:n}=PlainGallery;this.state===i.OPENING?(this.state=i.OPENED,this.fire(n.OPEN,this),this.fire(n.CHANGE,this)):this.state===i.SLIDING?(this.state=i.OPENED,this.fire(n.CHANGE,this)):this.state===i.CLOSING&&(this.state=i.CLOSED,this.fire(n.CLOSE,this),e.remove()),a.original.src=t.originalUrl,a.original.onload=()=>a.loaded=!0},a.loaded||e.append(a.placeholder),a.original&&e.append(a.original),e.css(`left:${i.left}px; top:${i.top}px; width:${i.width}px; height:${i.height}px`),this.shadeMask.el.append(e),e}open(t,e){const i=this.#c(t??0,e??0);this.#a(i)}slide(t){if(this.isTransitioning)return;this.state=PlainGallery.State.SLIDING;const{ordinal:e,index:i}=this.current,n=this.#c(e,i+t);if(!n)return;const s=(t,e)=>{const{current:i}=this,{width:n}=this.viewport;t>0?i.transX-=n:i.transX+=n,i.scale=i.initScale,i.transform(),e&&(i.ontransitionend=()=>i.remove())};s(t,!0),this.current=this.#r(n),this.current.style.display="none",this.#l(),this.#o(!1),s(-t,!1),this.current.style.display="block",setTimeout((()=>s(t,!1)))}close(){const{OPENED:t,CLOSING:e}=PlainGallery.State;this.isTransitioning||this.state!==t||(this.state=e,this.shadeMask.fadeOut(),this.current.restore())}on(t,e){this.addEventListener(t,(t=>e(t.detail)))}fire(t,e){this.dispatchEvent(new CustomEvent(t,{detail:e}))}}PlainGallery.Toolbar=class{gallery=null;el=PlainGallery.createElement('<div class="plga-toolbar">\n        <div class="plga-toolbar-left"></div>\n        <div class="plga-toolbar-right"></div>\n    </div>');constructor(t){this.gallery=t,this.left=this.el.querySelector(".plga-toolbar-left"),this.right=this.el.querySelector(".plga-toolbar-right"),this.register({html:'<div class="plga-counter"></div>',onInit:e=>{t.on(PlainGallery.Event.CHANGE,(()=>{const{ordinal:i,index:n}=t.current,s=t.dataSource[i].length;e.innerHTML=n+1+"/"+s}))}}),this.register({position:"right",html:'<svg xmlns="http://www.w3.org/2000/svg" class="plga-icon" viewBox="0 0 32 32" width="32"><path d="M24 10l-2-2-6 6-6-6-2 2 6 6-6 6 2 2 6-6 6 6 2-2-6-6z"/></svg>',onInit:e=>{e.onclick=()=>t.close()}}),t.shadeMask.el.append(this.el)}register(t){const{position:e,html:i,onInit:n}=t,{left:s,right:a}=this,r=PlainGallery.createElement(i);"right"==e?a.insertBefore(r,a.firstChild):s.append(r),t.onInit(r,this.gallery)}},PlainGallery.ShadeMask=class{gallery=null;el=PlainGallery.createElement('<div class="plga-shade-mask">\n        <svg class="plga-icon plga-icon-prev" viewBox="0 0 60 60" width="48"><path d="M29 43l-3 3-16-16 16-16 3 3-13 13 13 13z"/></svg>\n        <svg class="plga-icon plga-icon-next" viewBox="0 0 60 60" width="48"><path d="m31 43 3 3 16-16-16-16-3 3 13 13Z"/></svg>\n    </div>');constructor(t){this.gallery=t,this.#d(),this.prevBtn=this.el.querySelector(".plga-icon-prev"),this.nextBtn=this.el.querySelector(".plga-icon-next"),this.prevBtn.direction=-1,this.nextBtn.direction=1,document.body.append(this.el)}fadeIn(){const{el:t}=this;t.ontransitionend=null,t.style.display="flex",setTimeout((()=>t.style.background="rgba(0, 0, 0, .8)"))}fadeOut(){const{el:t}=this;t.style.background="rgba(0, 0, 0, 0)",t.ontransitionend=()=>t.style.display="none"}#d(){document.head.append(PlainGallery.createElement("<style>\n            .plga-shade-mask {\n                user-select: none;\n                display: none;\n                justify-content: space-between;\n                align-items: center;\n                position: fixed;\n                z-index: 998;\n                top: 0; left: 0; right: 0; bottom: 0;\n                background: rgba(0, 0, 0, 0);\n                color: #fff;\n                transition: background .3s;\n            }\n            .plga-icon {\n                z-index: 999;\n                fill: currentcolor;\n                cursor: pointer;\n                stroke: rgba(0,0,0,.3);\n                stroke-width: .2;\n            }\n            .plga-icon-prev, .plga-icon-next {\n                padding: 20px;\n            }\n            .plga-toolbar {\n                position: absolute;\n                z-index: 999;\n                top: 0; left: 0; right:0;\n                height: 60px;\n                padding: 0 15px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                text-shadow: 1px 1px 5px rgba(0,0,0,.3);\n            }\n            .plga-toolbar>div {\n                display: flex;\n                align-items: center;\n                gap: 15px;\n            }\n            .plga-preview-zone {\n                position: absolute;\n                cursor: zoom-in;\n                transform: translate(var(--transX), var(--transY)) scale(var(--scale));\n                transition: all .3s;\n                will-change: transform;\n            }\n            .plga-image-placeholder {\n                position: absolute;\n                max-width: 100%;\n                max-height: 100%;\n            }\n        </style>".replace(/\s+/g," ")))}};